<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Redirecting…</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
           display: grid; place-items: center; min-height: 100vh; margin: 0; }
    .wrap { text-align: center; padding: 24px; }
    a.btn { display: inline-block; padding: 10px 16px; border: 1px solid #ccc; 
            border-radius: 8px; text-decoration: none; }
    small { color: #666; display: block; margin-top: 8px; }
  </style>
  <script>
    (function () {
      // ✅ Product mapping table
      const PRODUCT_MAP = {
        "0": "aywugz",   // Default
        "1": "bqtkv",    // Example product 1
      };

      // Read params
      const params = new URLSearchParams(location.search);
      const emailParam = (params.get("emai") || params.get("email") || "").trim();
      const priceParam = (params.get("id") || params.get("price") || "").trim();
      const prodParam = (params.get("prod") || "0").trim(); // default to 0

      // Pick product ID based on prod param (fallback to "0" if not found)
      const PRODUCT_ID = PRODUCT_MAP[prodParam] || PRODUCT_MAP["0"];

      // Gumroad expects price as a non-decimal integer
      const price = priceParam.replace(/[^\d]/g, "");
      const email = emailParam;

      // Build target URL
      const gumroadBase = "https://gumroad.com/checkout";
      const qs = new URLSearchParams({
        product: PRODUCT_ID,
        quantity: "1",
        price,
        email,
      });
      const target = gumroadBase + "?" + qs.toString();

      // Redirect logic
      function redirectNow() {
        location.replace(target);
      }

      if (email && price) {
        redirectNow();
      } else {
        window.addEventListener("DOMContentLoaded", () => {
          const msg = document.getElementById("msg");
          const link = document.getElementById("fallback");
          msg.textContent = "There's an Error, Please Contact Support";
          link.href = target;
          link.style.display = "inline-block";
        });
      }
    })();
  </script>
</head>
<body>
  <div class="wrap">
    <h1 id="msg">Redirecting to checkout…</h1>
    <a id="fallback" class="btn" style="display:none;">Checkout manually</a>
    <small id="hint"></small>
    <noscript>
      JavaScript is required for automatic redirection.
      If you see this, enable JS and reload, or construct the link manually.
    </noscript>
  </div>
</body>
</html>
